# Database Setup Guide

This directory contains the database schema and migrations for the Finance Quest application.

## Prerequisites

- Supabase account (free tier is sufficient)
- PostgreSQL knowledge (basic)

## Setup Instructions

### 1. Create a Supabase Project

1. Go to [supabase.com](https://supabase.com) and sign up/login
2. Click "New Project"
3. Fill in project details:
   - Name: `finance-quiz-quest` (or your preferred name)
   - Database Password: (choose a strong password)
   - Region: (choose closest to your users)
4. Wait for the project to be created (~2 minutes)

### 2. Run the Database Schema

1. In your Supabase project, go to the **SQL Editor**
2. Click "New Query"
3. Copy the contents of `schema.sql` and paste it into the editor
4. Click "Run" to execute the schema

Alternatively, you can run the migration file:
- Copy contents of `migrations/001_create_questions_table.sql`
- Paste and run in SQL Editor

### 3. Get Your Supabase Credentials

1. In your Supabase project, go to **Settings** â†’ **API**
2. Copy the following values:
   - **Project URL** (looks like: `https://xxxxx.supabase.co`)
   - **anon/public key** (starts with `eyJ...`)

### 4. Configure Environment Variables

1. In your project root, open or create `.env.local`
2. Add the following variables:

```env
VITE_SUPABASE_URL=your-project-url-here
VITE_SUPABASE_ANON_KEY=your-anon-key-here
```

3. Save the file

### 5. Install Supabase Client

Run the following command in your project directory:

```bash
npm install @supabase/supabase-js
```

### 6. Verify Setup

You can verify the setup by checking the sample data:

1. In Supabase, go to **Table Editor**
2. Select the `questions` table
3. You should see 3 sample questions about Super Mario

## Database Schema Overview

### Table: `questions`

| Column           | Type         | Description                              |
|------------------|--------------|------------------------------------------|
| `id`             | SERIAL       | Auto-incrementing primary key            |
| `text`           | TEXT         | The question text                        |
| `option_a`       | VARCHAR(500) | First answer option                      |
| `option_b`       | VARCHAR(500) | Second answer option                     |
| `option_c`       | VARCHAR(500) | Third answer option                      |
| `option_d`       | VARCHAR(500) | Fourth answer option                     |
| `correct_answer` | CHAR(1)      | Correct option ('A', 'B', 'C', or 'D')   |
| `hint`           | TEXT         | Optional hint for the question           |
| `fun_fact`       | TEXT         | Fun fact about the question/answer       |
| `topic`          | VARCHAR(100) | Question topic/category                  |
| `difficulty`     | VARCHAR(20)  | Difficulty level (easy/medium/hard)      |
| `created_at`     | TIMESTAMP    | Creation timestamp                       |
| `updated_at`     | TIMESTAMP    | Last update timestamp                    |

## Usage Examples

### Using the Database Service

```typescript
import { 
  saveQuestions, 
  getQuestionsByTopic, 
  getRandomQuestions 
} from './services/databaseService';

// Save questions generated by Gemini
const questions = await fetchQuestions('super-mario');
await saveQuestions(questions, 'super-mario');

// Get all Super Mario questions
const marioQuestions = await getQuestionsByTopic('super-mario');

// Get 5 random medium difficulty questions
const randomQuestions = await getRandomQuestions(5, 'super-mario', 'medium');
```

### Direct SQL Queries (in Supabase SQL Editor)

```sql
-- Get all questions for a topic
SELECT * FROM questions WHERE topic = 'super-mario';

-- Get random questions
SELECT * FROM questions 
WHERE topic = 'super-mario' 
ORDER BY RANDOM() 
LIMIT 5;

-- Get questions by difficulty
SELECT * FROM questions 
WHERE difficulty = 'hard' AND topic = 'super-mario';

-- Count questions by topic
SELECT topic, COUNT(*) as question_count 
FROM questions 
GROUP BY topic;
```

## Row Level Security (RLS)

The schema includes RLS policies:

- **SELECT**: Anyone can view questions (public read access)
- **INSERT/UPDATE/DELETE**: Only authenticated users can modify questions

To modify these policies, go to **Authentication** â†’ **Policies** in Supabase.

## Migrations

Future schema changes should be added as new migration files:

- `002_add_user_id_column.sql`
- `003_add_tags_table.sql`
- etc.

Always use `IF NOT EXISTS` and `IF EXISTS` clauses to make migrations idempotent.

## Troubleshooting

### Error: "Supabase credentials not found"

Make sure you've added `VITE_SUPABASE_URL` and `VITE_SUPABASE_ANON_KEY` to `.env.local` and restarted your dev server.

### Error: "relation 'questions' does not exist"

Run the schema.sql file in the Supabase SQL Editor.

### Error: "new row violates row-level security policy"

You need to be authenticated to insert/update/delete questions. Either:
1. Modify the RLS policies to allow anonymous access
2. Implement authentication in your app

## Next Steps

1. âœ… Set up Supabase project
2. âœ… Run schema.sql
3. âœ… Configure environment variables
4. âœ… Install @supabase/supabase-js
5. ðŸ”„ Test the database service
6. ðŸ”„ Integrate with your game
7. ðŸ”„ Deploy to production

## Resources

- [Supabase Documentation](https://supabase.com/docs)
- [Supabase JavaScript Client](https://supabase.com/docs/reference/javascript/introduction)
- [Row Level Security Guide](https://supabase.com/docs/guides/auth/row-level-security)
